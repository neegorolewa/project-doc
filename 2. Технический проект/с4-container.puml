@startuml HotelBookingSystem Контейнер

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title "Система Бронирования Отелей. Диаграмма контейнеров"

Person(guest, "Гость", "Ищет и бронирует отели, управляет бронированиями, оставляет отзывы")
Person(hotelier, "Отельер", "Управляет информацией об отеле, номерами, тарифами и бронированиями")
Person(admin, "Администратор", "Модерирует контент, управляет отелями, анализирует статистику")
Person(partner, "Партнер/Агентство", "Интегрирует спецпредложения и акции")
Person(reception, "Менеджер ресепшена", "Подтверждает заезды/выезды, отмечает факт проживания")
Person(anon_user, "Анонимный пользователь", "Ищет отели без регистрации")


System_Boundary(systemApp, "Система бронирования отелей") {

    Container(webPortal, "Веб-портал", "Chrome 80+, IE 11+/Edge, Safari 12+; SPA на ReactTS", "Поиск отелей, бронирование номеров, управление профилем и бронированиями")
        guest --> webPortal : "Использует для бронирования и поиска"
        anon_user --> webPortal : "Просматривает отели без регистрации"
    
    Container(hotelAdminPanel, "Панель управления отелем", "Chrome 80+, IE 11+/Edge, Safari 12+; SPA на ReactTS", "Управление номерами, тарифами, бронированиями, ответы на отзывы")
        hotelier --> hotelAdminPanel : "Управляет отелем и тарифами"
        reception --> hotelAdminPanel : "Подтверждает заезды/выезды"
    
    Container(adminPanel, "Панель администратора", "Chrome 80+, IE 11+/Edge, Safari 12+; SPA на ReactTS", "Модерация контента, управление отелями и пользователями, аналитика")
        admin --> adminPanel : "Администрирует систему"

    Container(partnerPortal, "Партнерский портал", "Chrome 80+, IE 11+/Edge, Safari 12+; SPA на ReactTS", "Настройка спецпредложений, интеграция акций")
        partner --> partnerPortal : "Настраивает спецпредложения"

    Container(apiGateway, "API Gateway", "Nginx/Kong", "Маршрутизация, балансировка нагрузки, аутентификация")
        webPortal --> apiGateway : "API запросы REST API : HTTPS"
        hotelAdminPanel --> apiGateway : "API запросы REST API : HTTPS"
        adminPanel --> apiGateway : "API запросы REST API : HTTPS"
        partnerPortal --> apiGateway : "API запросы REST API : HTTPS"

    Container(authService, "Сервис аутентификации", "ASP.NET Core", "Регистрация, вход, управление ролями и правами")
        apiGateway --> authService : "Аутентификация и авторизация REST API : HTTPS"

    Container(searchService, "Сервис поиска", "ASP.NET Core", "Поиск отелей по фильтрам, рейтингам, доступности")
        apiGateway --> searchService : "Поиск отелей и номеров REST API : HTTPS"

    Container(bookingService, "Сервис бронирования", "ASP.NET Core", "Создание, изменение, отмена бронирований, управление проживанием")
        apiGateway --> bookingService : "Управление бронированиями REST API : HTTPS"
        bookingService --> authService : "Проверка прав доступа REST API : HTTPS"

    Container(hotelService, "Сервис управления отелями", "ASP.NET Core", "Управление информацией об отелях, номерах, тарифах")
        apiGateway --> hotelService : "CRUD операции по отелям REST API : HTTPS"
        hotelService --> authService : "Проверка прав отеля REST API : HTTPS"

    Container(reviewService, "Сервис отзывов и рейтингов", "ASP.NET Core", "Оставление, модерация и ответы на отзывы, управление рейтингами")
        apiGateway --> reviewService : "Управление отзывами REST API : HTTPS"

    Container(paymentService, "Сервис оплаты", "ASP.NET Core", "Обработка онлайн-платежей, возвратов, управление счетами")
        bookingService --> paymentService : "Инициирование платежей REST API : HTTPS"

    Container(notificationService, "Сервис уведомлений", "ASP.NET Core", "Отправка email/SMS уведомлений о бронированиях")
        bookingService --> notificationService : "Отправка подтверждений REST API : HTTPS"

    Container(partnerService, "Сервис партнеров", "ASP.NET Core", "Управление спецпредложениями, акциями, интеграция с агентствами")
        apiGateway --> partnerService : "Управление партнерскими программами REST API : HTTPS"

    Container(migrationService, "Сервис миграционного учета", "ASP.NET Core", "Обработка и передача данных гостей для государственного учета")
        bookingService --> migrationService : "Передача данных гостей REST API : HTTPS"

    ContainerDb(userDb, "База данных пользователей", "MSSQL", "Хранение данных пользователей, отелей, профилей, ролей")
        authService --> userDb : "Чтение/запись пользователей ORM(EF)"
        hotelService --> userDb : "Чтение/запись данных отелей ORM(EF)"
        partnerService --> userDb : "Чтение/запись партнерских данных ORM(EF)"

    ContainerDb(bookingDb, "База данных бронирований", "MSSQL", "Хранение бронирований, тарифов, доступности, статусов проживания")
        bookingService --> bookingDb : "Чтение/запись бронирований ORM(EF)"
        searchService --> bookingDb : "Поиск доступности ORM(EF)"
        migrationService --> bookingDb : "Чтение данных для учета ORM(EF)"

    ContainerDb(reviewDb, "База данных отзывов", "MSSQL", "Хранение отзывов, рейтингов, ответов, модерации")
        reviewService --> reviewDb : "Чтение/запись отзывов ORM(EF)"

    ContainerDb(paymentDb, "База данных платежей", "MSSQL", "Хранение транзакций, счетов, платежей, возвратов")
        paymentService --> paymentDb : "Чтение/запись платежей ORM(EF)"

    ContainerDb(partnerDb, "База данных партнеров", "MSSQL", "Хранение данных партнеров, акций, спецпредложений")
        partnerService --> partnerDb : "Чтение/запись партнерских данных ORM(EF)"

    Container(analyticsService, "Сервис аналитики", "ASP.NET Core", "Аналитика заполняемости, отчеты, статистика, KPI")
        apiGateway --> analyticsService : "Получение отчетов REST API : HTTPS"
        analyticsService --> bookingDb : "Анализ данных бронирований REST API : HTTPS"
        analyticsService --> userDb : "Анализ пользователей REST API : HTTPS"
        analyticsService --> paymentDb : "Анализ финансовых показателей REST API : HTTPS"
}

Container_Ext(paymentGateway, "Платежный шлюз", "МонетаРУ API", "Обработка онлайн-платежей")
    paymentService --> paymentGateway : "Обработка транзакций REST API : HTTPS"

Container_Ext(mapsApi, "Картографический API", "Яндекс.Карты", "Отображение локаций, геокодирование")
    searchService --> mapsApi : "Получение координат и карт REST API : HTTPS"

Container_Ext(emailService, "Email сервис", "SendGrid/Mailgun", "Отправка email сообщений")
    notificationService --> emailService : "Отправка email REST API : HTTPS"

Container_Ext(smsService, "SMS сервис", "Twilio/СМС-центр", "Отправка SMS сообщений")
    notificationService --> smsService : "Отправка SMS REST API : HTTPS"

Container_Ext(hotelPms, "PMS системы отелей", "External Hotel API", "Синхронизация данных о доступности номеров")
    hotelService --> hotelPms : "Синхронизация номеров REST API : HTTPS"

Container_Ext(gosuslugi, "Госуслуги API", "ЕСИА", "Верификация пользователей через госуслуги")
    authService --> gosuslugi : "Верификация пользователей REST API : HTTPS"

Container_Ext(mvdApi, "МВД РФ API", "Система миграционного учета", "Передача данных о проживающих для госучета")
    migrationService --> mvdApi : "Передача данных гостей REST API : HTTPS"

Rel_L(guest, hotelier, "Оставляет отзывы об отеле")

Rel_R(hotelier, guest, "Отвечает на отзывы гостей")

@enduml